import{Jt}from"./chunk-BMKRBKO4.js";import{j,k,w}from"./chunk-JEHWBBA4.js";import{le}from"./chunk-4M2GZMYH.js";function AudioPlayer({textToConvert,textId,setIsLoading}){let audioRef=w(typeof Audio<"u"?new Audio:null),[audioUrl,setAudioUrl]=k("https://hnshlqzjuzbgckjromvg.supabase.co/storage/v1/object/public/audioFiles/AliceExplained.mp3?t=2023-09-10T11%3A54%3A14.827Z"),[isPlaying,setIsPlaying]=k(!1),[currentTime,setCurrentTime]=k(0),[duration,setDuration]=k(0),[isDragging,setIsDragging]=k(!1),[speedMenuOpen,setSpeedMenuOpen]=k(!1),[speed,setSpeed]=k(1),speedMenuRef=w(null),formatTime=time=>{let minutes=Math.floor(time/60),seconds=time%60;return`${minutes}:${seconds.toString().padStart(2,"0")}`};j(()=>{if(!textToConvert||!textId)return;async function fetchAndSetAudioUrl(){setIsLoading(!0),console.log("Generating Audio");try{let body=JSON.stringify({script:textToConvert,text_id:textId}),response=await fetch("/api/audio",{method:"POST",headers:{"Content-Type":"application/json"},body});if(response.ok){let data=await response.json();setAudioUrl(data.url),setIsLoading(!1)}}catch(error){console.error("Failed to fetch audio URL:",error)}finally{setIsLoading(!1)}}fetchAndSetAudioUrl()},[textToConvert,textId]);let handleSkip=event=>{let rect=event.target.getBoundingClientRect(),x=event.clientX-rect.left,width=rect.width,newTime=x/width*duration;audioRef.current.currentTime=newTime};j(()=>{let handleMouseMove=event=>{isDragging&&handleSkip(event)},handleMouseUp=()=>{setIsDragging(!1),self.removeEventListener("mousemove",handleMouseMove),self.removeEventListener("mouseup",handleMouseUp)};return audioRef.current&&(audioRef.current.addEventListener("timeupdate",()=>{setCurrentTime(Math.floor(audioRef.current.currentTime))}),audioRef.current.addEventListener("loadedmetadata",()=>{setDuration(Math.floor(audioRef.current.duration))})),document.addEventListener("mousedown",event=>{event.target.closest(".progress-bar")&&(setIsDragging(!0),self.addEventListener("mousemove",handleMouseMove),self.addEventListener("mouseup",handleMouseUp))}),()=>{audioRef.current&&(audioRef.current.removeEventListener("timeupdate",()=>{}),audioRef.current.removeEventListener("loadedmetadata",()=>{})),self.removeEventListener("mousemove",handleMouseMove),self.removeEventListener("mouseup",handleMouseUp)}},[isDragging]),j(()=>{audioUrl&&audioRef.current&&(audioRef.current.src=audioUrl)},[audioUrl]);let handlePlayPause=()=>{audioRef.current&&(isPlaying?audioRef.current.pause():audioRef.current.play()),setIsPlaying(!isPlaying)};j(()=>{let handleClickOutside=event=>{speedMenuRef.current&&!speedMenuRef.current.contains(event.target)&&setSpeedMenuOpen(!1)};return self.addEventListener("mousedown",handleClickOutside),()=>{self.removeEventListener("mousedown",handleClickOutside)}},[]);let handleSpeedChange=newSpeed=>{audioRef.current.playbackRate=newSpeed,setSpeed(newSpeed),setSpeedMenuOpen(!1)},handleReplay=()=>{audioRef.current&&(audioRef.current.currentTime=0,audioRef.current.play()),setIsPlaying(!0)},progress=currentTime/duration*100,ReplayButton=()=>le("button",{class:Jt`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-center items-center shadow-lg`,onClick:()=>handleReplay()},le("svg",{class:Jt`fill-current text-white`,width:"24",height:"24"},le("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}))),SpeedButton=()=>le("button",{class:Jt`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-around items-center shadow-lg`,onClick:()=>setSpeedMenuOpen(!speedMenuOpen)},le("svg",{class:Jt`fill-current text-white`,width:"24",height:"24"},le("path",{d:"M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"}))),SpeedMenu=()=>le("div",{class:Jt`absolute bottom-32 bg-[#38A1FF] w-10 flex flex-col rounded-3xl shadow-lg`,ref:speedMenuRef},["0.75","1","1.5","1.75"].map(s=>le("button",{onClick:()=>handleSpeedChange(parseFloat(s)),class:Jt`hover:bg-[#318BDC] text-white rounded-full h-10 flex justify-around items-center`},s))),PlayButton=()=>le("button",{class:Jt`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-around items-center shadow-lg`,onClick:handlePlayPause},le("svg",{class:Jt`fill-current text-white`,width:"24",height:"24"},le("path",{d:isPlaying?"M6 19h4V5H6v14zm8-14v14h4V5h-4z":"M8 5v14l11-7z"})));return le("div",{class:Jt`fixed bottom-5 flex flex-col-reverse justify-center px-2 items-center w-full`},[le("div",{class:Jt`relative px-2 flex-col justify-center items-center bg-gray-100 rounded-full shadow-md w-full`},[le("div",{class:Jt`relative w-full max-w-screen flex flex-col justify-center items-center rounded-lg`,style:{maxWidth:"100vw"}},[le("div",{class:Jt`flex w-full justify-between items-center`},[le("span",{class:Jt`m-2 py-2`},formatTime(currentTime)),le("div",{class:Jt`relative flex-grow h-2 bg-gray-300 rounded-full progress-bar`,onClick:handleSkip},[le("div",{class:Jt`bg-[#38A1FF] rounded-full transition-all ease-linear duration-1000`,style:{width:`${progress}%`,height:"100%"}})]),le("span",{class:Jt`m-2`},formatTime(duration-currentTime))])])]),le("div",{class:Jt`w-full flex justify-between items-center p-4`},[ReplayButton(),PlayButton(),le("div",{class:Jt`flex items-center`},[SpeedButton(),speedMenuOpen&&SpeedMenu()])])])}export{AudioPlayer};
//# sourceMappingURL=chunk-CKP7RPZC.js.map
