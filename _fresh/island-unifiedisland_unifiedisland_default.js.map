{
  "version": 3,
  "sources": ["https://deno.land/x/get_ip@v2.0.0/mod.ts", "islands/UnifiedIsland/UnifiedIsland.tsx"],
  "sourcesContent": ["let endpoint: string;\nlet ipv6: boolean;\nconst ENDPOINT_IPV4 = 'https://api.ipify.org';\nconst ENDPOINT_IPV6 = 'https://api6.ipify.org';\n\nconst getData = async (endpoint: string) => {\n  const data = await (await fetch(`${endpoint}?format=json`)).json();\n  return data;\n};\n\nexport async function getIP({ipv6: boolean = false} = {}) {\n\tendpoint = ipv6 ? ENDPOINT_IPV6 : ENDPOINT_IPV4;\n\tconst response = await getData(endpoint);\n  return response.ip;\n}\n", "import { h, Fragment } from \"preact\";\nimport { useState, useEffect, useRef } from \"preact/hooks\";\nimport { tw } from \"twind\";\nimport InputField from \"./InputField.ts\";\nimport AudioPlayer from \"./AudioPlayer.ts\";\nimport SubjectCard from \"./SubjectCard.ts\";\nimport { getIP } from \"https://deno.land/x/get_ip/mod.ts\";\nimport { insertMetrics } from \"../../utils/insertMetrics.ts\";\n\nexport default function UnifiedIsland() {\n  const audioRef = useRef(typeof Audio !== 'undefined' ? new Audio() : null);\n  const [finalResponseText, setFinalResponseText] = useState(\"\");\n  const [textId, setTextId] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(true);\n  const [selectedItem, setSelectedItem] = useState(null);\n  const [showSubjectCard, setShowSubjectCard] = useState(true);\n  const [userInput, setUserInput] = useState(\"\");\n  const [voiceId, setVoiceId] = useState(\"\");\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n  const [userIp, setUserIp] = useState(null);\n  const [buttonPressCount, setButtonPressCount] = useState(0);\n\n  const getMyIP = async () => {\n    const ip = await getIP({ipv6: true});\n    console.log(`Your public IP is ${ip}`);\n    setUserIp(ip);\n    const metrics = {\n      ip: ip,\n      new: buttonPressCount\n    };\n    \n    // Make a POST request to the insertMetrics endpoint\n    const response = await fetch('/api/insertMetrics', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(metrics)\n    });\n  \n    if (!response.ok) {\n      // Handle error\n      console.error('Failed to insert metrics');\n    }\n  }\n\n  useEffect(() => {\n    const savedVoiceId = localStorage.getItem('voiceId');\n    if (savedVoiceId) {\n      setVoiceId(JSON.parse(savedVoiceId));\n    }\n  }, []);\n  \n  useEffect(() => {\n    localStorage.setItem('voiceId', JSON.stringify(voiceId));\n    console.log(\"Set voiceID to Localstorage: \" + voiceId)\n  }, [voiceId]);\n  \n  useEffect(() => {\n    console.log(\"Voice ID: \" + voiceId);\n  }, [voiceId]);\n\n  const handleTextGenerated = (text, id) => {\n    setFinalResponseText({ choices: [{ message: { function_call: { arguments: text } } }] });\n    setTextId(id);\n  };\n\n  return h(\"div\", { class: tw`flex flex-row items-center justify-center min-h-screen` }, [\n    isCollapsed && h(Fragment, {}, [\n      h(\"button\", {\n        onClick: () => { setFinalResponseText(\"\"); setSelectedItem(null); setShowSubjectCard(true); setAudioBlob(null); setAudioBlob(null);  },\n        class: tw`fixed z-10 top-5 right-0 transform -translate-x-1/2 w-12 h-12 bg-[#38A1FF] hover:bg-[#318BDC] text-white font-semibold flex justify-center items-center rounded-full shadow-lg`,\n      }, [\n        h(\"svg\", { class: tw`fill-current text-white`, width: \"24\", height: \"24\" },\n          h(\"path\", { d: \"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\" })\n        )\n      ]),\n      h(\"div\", {\n        class: tw`flex flex-col items-center justify-center z-0 w-full p-4`\n      }, [\n        !selectedItem && (!finalResponseText || finalResponseText === \"\") && h(InputField, { setFinalResponseText: handleTextGenerated, isLoading, setIsLoading, voiceId, setVoiceId }),\n          showSubjectCard && finalResponseText && h(SubjectCard, { \n            message: selectedItem || finalResponseText, \n            setAudioBlob: setAudioBlob,\n            userInput, \n            voiceId, \n            class: tw`w-auto max-w-xl` \n          }),\n        audioBlob && h(AudioPlayer, { audioBlob: audioBlob, setIsLoading, audioRef, class: tw`w-full` })\n      ])\n    ])\n  ])\n};\n"],
  "mappings": "uPAAA,IAAI,SACA,KACE,cAAgB,wBAChB,cAAgB,yBAEhB,QAAU,MAAOA,WACR,MAAO,MAAM,MAAM,GAAGA,SAAQ,cAAc,GAAG,KAAK,EAInE,eAAsB,MAAM,CAAC,KAAM,QAAU,EAAK,EAAI,CAAC,EAAG,CACzD,gBAAW,KAAO,cAAgB,eACjB,MAAM,QAAQ,QAAQ,GACtB,EAClB,CCLe,SAAR,eAAiC,CACtC,IAAM,SAAW,EAAO,OAAO,MAAU,IAAc,IAAI,MAAU,IAAI,EACnE,CAAC,kBAAmB,oBAAoB,EAAI,EAAS,EAAE,EACvD,CAAC,OAAQ,SAAS,EAAI,EAAS,IAAI,EACnC,CAAC,UAAW,YAAY,EAAI,EAAS,EAAK,EAC1C,CAAC,YAAa,cAAc,EAAI,EAAS,EAAI,EAC7C,CAAC,aAAc,eAAe,EAAI,EAAS,IAAI,EAC/C,CAAC,gBAAiB,kBAAkB,EAAI,EAAS,EAAI,EACrD,CAAC,UAAW,YAAY,EAAI,EAAS,EAAE,EACvC,CAAC,QAAS,UAAU,EAAI,EAAS,EAAE,EACnC,CAAC,UAAW,YAAY,EAAI,EAAsB,IAAI,EACtD,CAAC,OAAQ,SAAS,EAAI,EAAS,IAAI,EACnC,CAAC,iBAAkB,mBAAmB,EAAI,EAAS,CAAC,EAEpD,QAAU,SAAY,CAC1B,IAAM,GAAK,MAAM,MAAM,CAAC,KAAM,EAAI,CAAC,EACnC,QAAQ,IAAI,qBAAqB,EAAE,EAAE,EACrC,UAAU,EAAE,GAOK,MAAM,MAAM,qBAAsB,CACjD,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAXG,CACd,GACA,IAAK,gBACP,CAQ8B,CAC9B,CAAC,GAEa,IAEZ,QAAQ,MAAM,0BAA0B,CAE5C,EAEA,EAAU,IAAM,CACd,IAAM,aAAe,aAAa,QAAQ,SAAS,EAC/C,cACF,WAAW,KAAK,MAAM,YAAY,CAAC,CAEvC,EAAG,CAAC,CAAC,EAEL,EAAU,IAAM,CACd,aAAa,QAAQ,UAAW,KAAK,UAAU,OAAO,CAAC,EACvD,QAAQ,IAAI,gCAAkC,OAAO,CACvD,EAAG,CAAC,OAAO,CAAC,EAEZ,EAAU,IAAM,CACd,QAAQ,IAAI,aAAe,OAAO,CACpC,EAAG,CAAC,OAAO,CAAC,EAEZ,IAAM,oBAAsB,CAAC,KAAM,KAAO,CACxC,qBAAqB,CAAE,QAAS,CAAC,CAAE,QAAS,CAAE,cAAe,CAAE,UAAW,IAAK,CAAE,CAAE,CAAC,CAAE,CAAC,EACvF,UAAU,EAAE,CACd,EAEA,OAAO,GAAE,MAAO,CAAE,MAAO,0DAA2D,EAAG,CACrF,aAAe,GAAE,EAAU,CAAC,EAAG,CAC7B,GAAE,SAAU,CACV,QAAS,IAAM,CAAE,qBAAqB,EAAE,EAAG,gBAAgB,IAAI,EAAG,mBAAmB,EAAI,EAAG,aAAa,IAAI,EAAG,aAAa,IAAI,CAAI,EACrI,MAAO,kLACT,EAAG,CACD,GAAE,MAAO,CAAE,MAAO,4BAA6B,MAAO,KAAM,OAAQ,IAAK,EACvE,GAAE,OAAQ,CAAE,EAAG,qCAAsC,CAAC,CACxD,CACF,CAAC,EACD,GAAE,MAAO,CACP,MAAO,4DACT,EAAG,CACD,CAAC,eAAiB,CAAC,mBAAqB,oBAAsB,KAAO,GAAE,WAAY,CAAE,qBAAsB,oBAAqB,UAAW,aAAc,QAAS,UAAW,CAAC,EAC5K,iBAAmB,mBAAqB,GAAE,YAAa,CACrD,QAAS,cAAgB,kBACzB,aACA,UACA,QACA,MAAO,mBACT,CAAC,EACH,WAAa,GAAE,YAAa,CAAE,UAAsB,aAAc,SAAU,MAAO,UAAW,CAAC,CACjG,CAAC,CACH,CAAC,CACH,CAAC,CACH",
  "names": ["endpoint"]
}
