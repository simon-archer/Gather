{
  "version": 3,
  "sources": ["islands/UnifiedIsland/AudioPlayer.ts"],
  "sourcesContent": ["import { h } from \"preact\";\nimport { useEffect, useRef, useState } from \"preact/hooks\";\nimport { tw } from \"twind\";\n\nexport default function AudioPlayer({ textToConvert, textId, setIsLoading }) {\n  const audioRef = useRef(typeof Audio !== 'undefined' ? new Audio() : null);\n  const [audioUrl, setAudioUrl] = useState(\n    'https://hnshlqzjuzbgckjromvg.supabase.co/storage/v1/object/public/audioFiles/AliceExplained.mp3?t=2023-09-10T11%3A54%3A14.827Z'\n  );\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const [speedMenuOpen, setSpeedMenuOpen] = useState(false);\n  const [speed, setSpeed] = useState(1);\n  const speedMenuRef = useRef(null);\n\n // Utility function to format time\nconst formatTime = (time) => {\n  const minutes = Math.floor(time / 60);\n  const seconds = time % 60;\n  return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n};\n\n  useEffect(() => {\n    if (!textToConvert || !textId) return;\n\n    async function fetchAndSetAudioUrl() {\n      setIsLoading(true);\n      console.log(\"Generating Audio\");\n      try {\n        const body = JSON.stringify({ script: textToConvert, text_id: textId });\n        const response = await fetch(\"/api/audio\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: body,\n        });\n\n        if (response.ok) {\n          const data = await response.json();\n          setAudioUrl(data.url);\n          setIsLoading(false);\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch audio URL:\", error);\n      } finally {\n        setIsLoading(false); // Set loading to false after fetching\n      }\n    }\n\n    fetchAndSetAudioUrl();\n  }, [textToConvert, textId]);\n\n  const handleSkip = (event) => {\n    const rect = event.target.getBoundingClientRect();\n    const x = event.clientX - rect.left; // x position within the element\n    const width = rect.width;\n    const newTime = (x / width) * duration;\n    audioRef.current.currentTime = newTime;\n  };\n  \n\n  useEffect(() => {\n    const handleMouseMove = (event) => {\n      if (isDragging) {\n        handleSkip(event);\n      }\n    };\n  \n    const handleMouseUp = () => {\n      setIsDragging(false);\n      self.removeEventListener('mousemove', handleMouseMove);\n      self.removeEventListener('mouseup', handleMouseUp);\n    };\n  \n    if (audioRef.current) {\n      audioRef.current.addEventListener('timeupdate', () => {\n        setCurrentTime(Math.floor(audioRef.current.currentTime));\n      });\n      audioRef.current.addEventListener('loadedmetadata', () => {\n        setDuration(Math.floor(audioRef.current.duration));\n      });\n    }\n    \n    // Listen to mousedown on the document for your progress bar\n    document.addEventListener('mousedown', (event) => {\n      if (event.target.closest('.progress-bar')) { // Add a class to your progress bar div\n        setIsDragging(true);\n        self.addEventListener('mousemove', handleMouseMove);\n        self.addEventListener('mouseup', handleMouseUp);\n      }\n    });\n  \n    return () => {\n      if (audioRef.current) {\n        audioRef.current.removeEventListener('timeupdate', () => {});\n        audioRef.current.removeEventListener('loadedmetadata', () => {});\n      }\n      self.removeEventListener('mousemove', handleMouseMove);\n      self.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isDragging]);\n\n  useEffect(() => {\n    if (audioUrl && audioRef.current) {\n      audioRef.current.src = audioUrl;\n    }\n  }, [audioUrl]);\n\n  const handlePlayPause = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play();\n      }\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  useEffect(() => {\n    const handleClickOutside = (event) => {\n      if (speedMenuRef.current && !speedMenuRef.current.contains(event.target)) {\n        setSpeedMenuOpen(false);\n      }\n    };\n    self.addEventListener('mousedown', handleClickOutside);\n  \n    return () => {\n      self.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, []);\n\n  const handleSpeedChange = (newSpeed) => {\n    audioRef.current.playbackRate = newSpeed;\n    setSpeed(newSpeed);\n    setSpeedMenuOpen(false);\n  };\n\n  const handleReplay = () => {\n    if (audioRef.current) {\n      audioRef.current.currentTime = 0; // Reset audio time to start\n      audioRef.current.play(); // Play the audio\n    }\n    setIsPlaying(true); // Update the isPlaying state\n  };\n\n  const progress = (currentTime / duration) * 100;\n\n  const ReplayButton = () => h(\"button\", { class: tw`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-center items-center shadow-lg`, onClick: () => handleReplay()}, h(\"svg\", { class: tw`fill-current text-white`, width: \"24\", height: \"24\" },h(\"path\", { d: \"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z\" })));\n  const SpeedButton = () => h(\"button\", { class: tw`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-around items-center shadow-lg`, onClick: () => setSpeedMenuOpen(!speedMenuOpen)}, h(\"svg\", { class: tw`fill-current text-white`, width: \"24\", height: \"24\" },h(\"path\", { d: \"M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44zm-9.79 6.84a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z\" }) ));\n  const SpeedMenu = () => h(\"div\", { class: tw`absolute bottom-32 bg-[#38A1FF] w-10 flex flex-col rounded-3xl shadow-lg`, ref: speedMenuRef }, ['0.75', '1', '1.5', '1.75'].map(s => h(\"button\", { onClick: () => handleSpeedChange(parseFloat(s)), class: tw`hover:bg-[#318BDC] text-white rounded-full h-10 flex justify-around items-center`}, s)));\n  const PlayButton = () => h(\"button\", { class: tw`bg-[#38A1FF] hover:bg-[#318BDC] text-white rounded-full w-10 h-10 flex justify-around items-center shadow-lg`,onClick: handlePlayPause },h(\"svg\", { class: tw`fill-current text-white`, width: \"24\", height: \"24\" }, h(\"path\", { d: isPlaying ? \"M6 19h4V5H6v14zm8-14v14h4V5h-4z\" : \"M8 5v14l11-7z\" })));\n\n  return h(\"div\", { class: tw`fixed bottom-5 flex flex-col-reverse justify-center px-2 items-center w-full` },\n[\n  h(\"div\", { class: tw`relative px-2 flex-col justify-center items-center bg-gray-100 rounded-full shadow-md w-full` },\n    [\n      h(\"div\", { class: tw`relative w-full max-w-screen flex flex-col justify-center items-center rounded-lg`,\n                 style: { maxWidth: '100vw' } },\n        [\n          h(\"div\", { class: tw`flex w-full justify-between items-center` }, \n            [\n              h(\"span\", { class: tw`m-2 py-2` }, formatTime(currentTime)),\n              h(\"div\", { \n                class: tw`relative flex-grow h-2 bg-gray-300 rounded-full progress-bar`, \n                onClick: handleSkip\n                },\n                [\n                  h(\"div\", { \n                    class: tw`bg-[#38A1FF] rounded-full transition-all ease-linear duration-1000`, \n                    style: { width: `${progress}%`, height: '100%' } \n                  })\n                ]\n              ),\n              h(\"span\", { class: tw`m-2` }, formatTime(duration - currentTime))\n            ]\n          )\n        ]\n      )\n    ]\n  ),\n  h(\"div\", { class: tw`w-full flex justify-between items-center p-4` }, \n    [\n      ReplayButton(),\n      PlayButton(),\n      h(\"div\", { class: tw`flex items-center` },\n        [\n          SpeedButton(),\n          speedMenuOpen && SpeedMenu()\n        ]\n      )\n    ]\n  ),\n]);\n}"],
  "mappings": "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",
  "names": []
}
